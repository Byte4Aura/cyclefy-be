//USERS
model User {
    id                Int       @id @default(autoincrement())
    fullname          String?   @db.VarChar(255)
    username          String    @unique @db.VarChar(255)
    email             String    @unique @db.VarChar(255)
    password          String    @db.VarChar(255)
    is_email_verified Boolean   @default(false)
    email_verified_at DateTime?
    profile_picture   String?   @db.VarChar(255)
    is_active         Boolean   @default(true)
    created_at        DateTime  @default(now())
    updated_at        DateTime  @updatedAt

    phones             Phone[]
    addresses          Address[]
    donations          Donation[]
    barters            Barter[]
    borrows            Borrow[]
    recycles           Recycle[]
    repairs            Repair[]
    borrowApplications BorrowApplication[]
    barterApplications BarterApplication[]
    emailVerifications EmailVerification[]
    userOauthProviders UserOauthProvider[]
    passwordResets     PasswordReset[]

    donationStatusHistories DonationStatusHistory[]

    barterStatusHistories            BarterStatusHistory[]
    barterApplicationStatusHistories BarterApplicationStatusHistory[]

    borrowStatusHistories            BorrowStatusHistory[]
    borrowApplicationStatusHistories BorrowApplicationStatusHistory[]

    recycleStatusHistories RecycleStatusHistory[]
    repairStatusHistories  RepairStatusHistory[]
    repairPayments         RepairPayment[]

    notifications Notification[]

    @@map("users")
}

// PHONES
model Phone {
    id         Int      @id @default(autoincrement())
    user       User     @relation(fields: [user_id], references: [id])
    user_id    Int
    number     String   @db.VarChar(255)
    created_at DateTime @default(now())
    updated_at DateTime @updatedAt

    donations          Donation[]
    barters            Barter[]
    borrows            Borrow[]
    recycles           Recycle[]
    repairs            Repair[]
    borrowApplications BorrowApplication[]
    barterApplications BarterApplication[]

    @@map("phones")
}

// ADDRESSES
model Address {
    id           Int      @id @default(autoincrement())
    user         User     @relation(fields: [user_id], references: [id])
    user_id      Int
    address_name String   @db.VarChar(255)
    address      String   @db.VarChar(255)
    latitude     Float    @db.Double
    longitude    Float    @db.Double
    city         String?  @db.VarChar(255)
    state        String?  @db.VarChar(255)
    country      String   @db.VarChar(255)
    country_code String   @db.VarChar(255)
    zipcode      String?  @db.VarChar(255)
    created_at   DateTime @default(now())
    updated_at   DateTime @updatedAt

    donations          Donation[]
    barters            Barter[]
    borrows            Borrow[]
    recycles           Recycle[]
    repairs            Repair[]
    borrowApplications BorrowApplication[]
    barterApplications BarterApplication[]

    @@map("addresses")
}

// EMAIL_VERIFICATIONS
model EmailVerification {
    id                Int       @id @default(autoincrement())
    user              User      @relation(fields: [user_id], references: [id])
    user_id           Int
    verification_code String    @db.VarChar(255)
    expires_at        DateTime
    verified_at       DateTime?
    // attempts          Int       @default(0)
    is_used           Boolean   @default(false)
    created_at        DateTime  @default(now())

    @@map("email_verifications")
}

// USER_OAUTH_PROVIDERS
model UserOauthProvider {
    id             Int      @id @default(autoincrement())
    user           User     @relation(fields: [user_id], references: [id])
    user_id        Int
    provider       String   @db.VarChar(255)
    provider_id    String   @db.VarChar(255)
    provider_email String   @db.VarChar(255)
    provider_data  Json?
    created_at     DateTime @default(now())
    updated_at     DateTime @updatedAt

    @@unique([user_id, provider])
    @@map("user_oauth_providers")
}

// PASSWORD_RESETS
model PasswordReset {
    id         Int      @id @default(autoincrement())
    user       User     @relation(fields: [user_id], references: [id])
    user_id    Int
    otp        String   @db.VarChar(255)
    expires_at DateTime
    is_used    Boolean  @default(false)
    created_at DateTime @default(now())

    @@map("password_resets")
}
