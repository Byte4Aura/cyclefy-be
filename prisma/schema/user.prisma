//USERS
model User {
    id                Int       @id @default(autoincrement())
    username          String    @unique @db.VarChar(255)
    email             String    @unique @db.VarChar(255)
    password          String    @db.VarChar(255)
    is_email_verified Boolean   @default(false)
    email_verified_at DateTime?
    profile_picture   String?   @db.VarChar(255)
    is_active         Boolean   @default(true)
    created_at        DateTime  @default(now())
    updated_at        DateTime  @updatedAt

    phones             Phone[]
    addresses          Address[]
    donations          Donation[]
    barters            Barter[]
    borrows            Borrow[]
    recycles           Recycle[]
    repairs            Repair[]
    borrowApplications BorrowApplication[]
    barterApplications BarterApplication[]
    emailVerifications EmailVerification[]
    userOauthProviders UserOauthProvider[]
    passwordResets     PasswordReset[]

    donationStatusHistories DonationStatusHistory[]

    barterStatusHistories            BarterStatusHistory[]
    barterApplicationStatusHistories BarterApplicationStatusHistory[]

    borrowStatusHistories            BorrowStatusHistory[]
    borrowApplicationStatusHistories BorrowApplicationStatusHistory[]

    recycleStatusHistories RecycleStatusHistory[]
    repairStatusHistories  RepairStatusHistory[]
    repairPayments         RepairPayment[]
}

// PHONES
model Phone {
    id         Int      @id @default(autoincrement())
    user       User     @relation(fields: [user_id], references: [id])
    user_id    Int
    number     String   @db.VarChar(255)
    created_at DateTime @default(now())
    updated_at DateTime @updatedAt

    donations          Donation[]
    barters            Barter[]
    borrows            Borrow[]
    recycles           Recycle[]
    repairs            Repair[]
    borrowApplications BorrowApplication[]
    barterApplications BarterApplication[]
}

// ADDRESSES
model Address {
    id         Int      @id @default(autoincrement())
    user       User     @relation(fields: [user_id], references: [id])
    user_id    Int
    address    String   @db.VarChar(255)
    latitude   Float    @db.Double
    longitude  Float    @db.Double
    created_at DateTime @default(now())
    updated_at DateTime @updatedAt

    donations          Donation[]
    barters            Barter[]
    borrows            Borrow[]
    recycles           Recycle[]
    repairs            Repair[]
    borrowApplications BorrowApplication[]
    barterApplications BarterApplication[]
}

// EMAIL_VERIFICATIONS
model EmailVerification {
    id                Int       @id @default(autoincrement())
    user              User      @relation(fields: [user_id], references: [id])
    user_id           Int
    verification_code String    @db.VarChar(255)
    expires_at        DateTime
    verified_at       DateTime?
    attempts          Int       @default(0)
    is_used           Boolean   @default(false)
    created_at        DateTime  @default(now())
}

// USER_OAUTH_PROVIDERS
model UserOauthProvider {
    id             Int      @id @default(autoincrement())
    user           User     @relation(fields: [user_id], references: [id])
    user_id        Int
    provider       String   @db.VarChar(255)
    provider_id    String   @db.VarChar(255)
    provider_email String   @db.VarChar(255)
    provider_data  Json?
    created_at     DateTime @default(now())
    updated_at     DateTime @updatedAt
}

// PASSWORD_RESETS
model PasswordReset {
    id         Int       @id @default(autoincrement())
    email      String    @db.VarChar(255)
    token      String    @db.VarChar(255)
    expires_at DateTime
    used_at    DateTime?
    created_at DateTime  @default(now())
    User       User?     @relation(fields: [user_id], references: [id])
    user_id    Int?
}
